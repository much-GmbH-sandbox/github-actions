# Pre-commit hooks for Odoo development
# Install: pip install pre-commit && pre-commit install
# Run manually: pre-commit run --all-files
# Docs: https://github.com/YOUR_ORG/github-actions/blob/main/.github/docs/PRE_COMMIT.md
#
# Required config files in your repo:
#   .flake8        - Flake8 configuration
#   .bandit        - Bandit security config
#   .pylintrc      - Pylint-Odoo config (copy from .pylintrc-odoo{VERSION})
#   pyproject.toml - Black configuration
#   radon.cfg      - Radon complexity config (optional)

exclude: |
  (?x)
  # Files and folders generated by bots
  ^setup/|/static/description/index\.html$|
  # Tool-generated files
  .svg$|/tests/([^/]+/)?cassettes/|^.copier-answers.yml$|^.github/|
  # Library files
  /static/(src/)?lib/|
  # Legal texts
  (LICENSE.*|COPYING.*)

default_language_version:
  python: python3

repos:
  # Autoflake - Remove unused imports and variables
  - repo: https://github.com/myint/autoflake
    rev: v2.3.1
    hooks:
      - id: autoflake
        args:
          - --expand-star-imports
          - --ignore-init-module-imports
          - --in-place
          - --remove-all-unused-imports
          - --remove-duplicate-keys
          - --remove-unused-variables

  # Black - Code formatting
  - repo: https://github.com/psf/black
    rev: 24.10.0
    hooks:
      - id: black
        args: [--config=pyproject.toml]

  # isort - Import sorting
  - repo: https://github.com/PyCQA/isort
    rev: 5.13.2
    hooks:
      - id: isort
        name: isort except __init__.py
        args: [--settings-path=.]
        exclude: /__init__\.py$

  # Flake8 - Linting
  - repo: https://github.com/PyCQA/flake8
    rev: 7.1.1
    hooks:
      - id: flake8
        args: [--config=.flake8]
        additional_dependencies: ["flake8-bugbear==24.12.12"]

  # Standard pre-commit hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        exclude: /README\.rst$|\.pot?$
      - id: end-of-file-fixer
        exclude: /README\.rst$|\.pot?$
      - id: debug-statements
      - id: fix-encoding-pragma
        args: ["--remove"]
      - id: check-case-conflict
      - id: check-docstring-first
      - id: check-merge-conflict
        exclude: /README\.rst$|^docs/.*\.rst$
      - id: check-xml
      - id: check-yaml
      - id: check-added-large-files
        args: [--maxkb=500]
      - id: mixed-line-ending
        args: ["--fix=lf"]

  # pyupgrade - Upgrade Python syntax
  - repo: https://github.com/asottile/pyupgrade
    rev: v3.19.1
    hooks:
      - id: pyupgrade
        args: ["--keep-percent-format", "--py310-plus"]

  # OCA Odoo pre-commit hooks
  - repo: https://github.com/OCA/odoo-pre-commit-hooks
    rev: v0.1.1
    hooks:
      - id: oca-checks-odoo-module
      - id: oca-checks-po
        args: ["--fix"]

  # Pylint-Odoo - Odoo-specific linting
  # Copy the appropriate .pylintrc-odoo{VERSION} to .pylintrc in your repo
  - repo: https://github.com/OCA/pylint-odoo
    rev: v9.1.3
    hooks:
      - id: pylint_odoo
        args: [--rcfile=.pylintrc]
        verbose: true

  # Bandit - Security checks
  - repo: https://github.com/PyCQA/bandit
    rev: 1.8.2
    hooks:
      - id: bandit
        args: ["--ini", ".bandit"]
        exclude: ^tests/

  # Xenon - Code complexity (alternative to radon)
  - repo: https://github.com/yunojuno/pre-commit-xenon
    rev: v0.1
    hooks:
      - id: xenon
        args: ["--max-average=A", "--max-modules=C", "--max-absolute=C"]
        exclude: ^tests/

  # Prettier - XML/JSON/YAML formatting (optional)
  # - repo: https://github.com/pre-commit/mirrors-prettier
  #   rev: v4.0.0-alpha.8
  #   hooks:
  #     - id: prettier
  #       name: prettier (with plugin-xml)
  #       additional_dependencies:
  #         - "prettier@3.4.2"
  #         - "@prettier/plugin-xml@3.4.1"
  #       args:
  #         - --plugin=@prettier/plugin-xml
  #       types_or: [xml, json, yaml]
